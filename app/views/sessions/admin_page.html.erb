<% @page_title = "Alumni Survey | Admin Page" -%>
<style type="text/css">
	table {
		border: 1px solid black;
		border-collapse: collapse;
	}
	td {
		border: 1px solid black;
		text-align: center;
		width: 150px;
	}
	th {
		border: 1px solid black;
		text-align: center;
		text-decoration: underline;
		font-weight: bold;
		background-color: #555555;
	}
</style>
<div class = "Admin_Page">
	<h2 class='User_Header'>Welcome <%= @current_user.username%>!!!</h2>
	<p>
		Statistics
	</p>
	<table>
		<tr>
			<td>Total no. of users</td>
			<td><%= User.where(:is_admin => false).count %></td>
		</tr>
		<tr>
			<td>Completed surveys</td>
			<td><%= User.where(:is_admin => false, :current_page => "thank_you").count %></td>
		</tr>
	</table>
	<p>
		List of all users
	</p>
	<table>
		<tr>
			<th>Username</th>
			<th>Email</th>
			<th>Consent Decision</th>
			<th>Status</th>
			<th>Date created</th>
			<th>Is Admin?</th>
			<th>Excel</th>
			<th>Delete</th>
		</tr>
		<% @users.each do | user | %>
		<tr>
			<td><%= user.username %></td>
			<td><%= user.email %></td>
			<td><%= user.accepted %></td>
			<% if user.current_page == "thank_you" or user.current_page == "admin_page"%>
			<td> <%= "Completed"%></td>
			<% else %>
			<td> <%= "In Progress"%></td>
			<% end %>
			<td><%= Date.strptime(user.created_at, '%s').to_s %></td>
			<td><%= user.is_admin %></td>
			<td><%= link_to "Download", download_xls_path( format: "xls", :id => user.id)  %></td>
			<% if user.is_admin %>
			<td><%= "" %></td>
			<% else %>
			<td><%= link_to "Delete" , delete_path(:id => user.id) ,  data: { confirm: "Are you sure?" }%></td>
			<% end%>
		</tr>
		<% end %>
	</table>
</div>